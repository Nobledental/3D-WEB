<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>HealthFlo Family</title>

  <!-- Icons & Fonts -->
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <link
    href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Inter:wght@300;400;500;600;700&display=swap"
    rel="stylesheet">

  <!-- Shared Theme -->
  <link rel="stylesheet" href="css/dashboard-theme.css">
  <link rel="stylesheet" href="css/patient-connections.css">
</head>

<body>

  <div class="app-container">
    <!-- BROWSER BAR (Shared) -->
    <div class="browser-bar">
      <div class="window-controls">
        <div class="window-dot" style="background: #ef4444;"></div>
        <div class="window-dot" style="background: #f59e0b;"></div>
        <div class="window-dot" style="background: #10b981;"></div>
      </div>
      <div class="branding-right">HealthFlo <span>CLINICAL V3</span></div>
    </div>

    <div class="dashboard-body">
      <!-- SIDEBAR (Shared) -->
      <div class="sidebar">
        <div class="logo">H<span>+</span></div>
        <a class="menu-item" href="patient-dashboard.html"><i class="ph ph-heartbeat"></i><span
            class="menu-label">Dashboard</span></a>
        <a class="menu-item" href="patient-health.html"><i class="ph ph-pulse"></i><span
            class="menu-label">Health</span></a>
        <a class="menu-item" href="patient-organs.html"><i class="ph ph-scan"></i><span
            class="menu-label">Organs</span></a>
        <a class="menu-item" href="patient-labs.html"><i class="ph ph-flask"></i><span
            class="menu-label">Labs</span></a>
        <a class="menu-item" href="patient-pharmacy.html"><i class="ph ph-pill"></i><span
            class="menu-label">Pharmacy</span></a>
        <a class="menu-item" href="patient-hospitals.html"><i class="ph ph-hospital"></i><span
            class="menu-label">Hospitals</span></a>
        <a class="menu-item" href="patient-insurance.html"><i class="ph ph-shield-plus"></i><span
            class="menu-label">Insurance</span></a>
        <a class="menu-item" href="patient-log.html"><i class="ph ph-clipboard-text"></i><span
            class="menu-label">Log</span></a>
        <a class="menu-item" href="patient-devices.html"><i class="ph ph-watch"></i><span
            class="menu-label">Devices</span></a>
        <!-- Active State for Family -->
        <a class="menu-item active" href="patient-family.html"><i class="ph-fill ph-users"></i><span
            class="menu-label">Family</span></a>
        <a class="menu-item" href="patient-profile.html"><i class="ph ph-user"></i><span
            class="menu-label">Profile</span></a>
        <div class="sidebar-divider"></div>
        <a class="menu-item" href="patient-settings.html"><i class="ph ph-gear-six"></i><span
            class="menu-label">Settings</span></a>
        <a class="menu-item danger" href="index.html" style="margin-top: auto;"><i class="ph ph-power"></i><span
            class="menu-label">Exit</span></a>
      </div>

      <div class="main-content">

        <div class="header-section">
          <div class="header-left">
            <div class="page-title">
              <h2>My Circle</h2>
              <h1>Family & <span>Care</span></h1>
            </div>
          </div>
          <button class="action-btn" onclick="openAddMemberModal()"
            style="margin-left:auto; background:var(--color-blue); color:white; border:none; padding:10px 20px; border-radius:12px; cursor:pointer; font-weight:700; display:flex; align-items:center; gap:8px;">
            <i class="ph-bold ph-plus"></i> Add Member
          </button>
        </div>

        <!-- Family Members Grid -->
        <div class="section-grid"
          style="display:grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap:20px;">

          <!-- 1. Father -->
          <div class="family-card"
            style="background:linear-gradient(135deg, rgba(30,41,59,0.5), rgba(0,0,0,0.4)); border:1px solid var(--glass-border); padding:20px; border-radius:20px;">
            <div class="head" style="display:flex; gap:15px; align-items:center; margin-bottom:20px;">
              <img src="https://i.pravatar.cc/150?u=dad"
                style="width:50px; height:50px; border-radius:50%; border:2px solid var(--color-green);">
              <div style="flex:1;">
                <h3 style="margin:0; font-size:18px;">Dad</h3>
                <div style="font-size:12px; color:var(--color-green); display:flex; gap:6px; align-items:center;">
                  <span
                    style="width:6px; height:6px; background:currentColor; border-radius:50%; box-shadow:0 0 10px currentColor;"></span>
                  Online • At Home
                </div>
              </div>
              <button class="pill small ghost">Call</button>
            </div>

            <!-- Mini Vitals -->
            <div class="mini-vitals" style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px;">
              <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:12px;">
                <div class="muted" style="font-size:10px;">Heart Rate</div>
                <div style="font-size:18px; font-weight:700;">72</div>
              </div>
              <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:12px;">
                <div class="muted" style="font-size:10px;">BP</div>
                <div style="font-size:18px; font-weight:700;">128/80</div>
              </div>
              <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:12px;">
                <div class="muted" style="font-size:10px;">SpO2</div>
                <div style="font-size:18px; font-weight:700;">97%</div>
              </div>
            </div>
            <div style="margin-top:15px; font-size:12px; opacity:0.6;">
              <i class="ph-fill ph-check-circle"></i> Meds taken at 9:00 AM
            </div>
          </div>

          <!-- 2. Mom -->
          <div class="family-card"
            style="background:linear-gradient(135deg, rgba(30,41,59,0.5), rgba(0,0,0,0.4)); border:1px solid var(--glass-border); padding:20px; border-radius:20px;">
            <div class="head" style="display:flex; gap:15px; align-items:center; margin-bottom:20px;">
              <img src="https://i.pravatar.cc/150?u=mom"
                style="width:50px; height:50px; border-radius:50%; border:2px solid var(--color-yellow);">
              <div style="flex:1;">
                <h3 style="margin:0; font-size:18px;">Mom</h3>
                <div style="font-size:12px; color:var(--color-yellow); display:flex; gap:6px; align-items:center;">
                  <span style="width:6px; height:6px; background:currentColor; border-radius:50%;"></span>
                  Away • 2km
                </div>
              </div>
              <button class="pill small ghost">Map</button>
            </div>

            <!-- Mini Vitals -->
            <div class="mini-vitals" style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px;">
              <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:12px;">
                <div class="muted" style="font-size:10px;">Heart Rate</div>
                <div style="font-size:18px; font-weight:700;">88</div>
              </div>
              <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:12px;">
                <div class="muted" style="font-size:10px;">Glucose</div>
                <div style="font-size:18px; font-weight:700; color:var(--color-yellow);">140</div>
              </div>
              <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:12px;">
                <div class="muted" style="font-size:10px;">Steps</div>
                <div style="font-size:18px; font-weight:700;">4.2k</div>
              </div>
            </div>
            <div style="margin-top:15px; font-size:12px; color:var(--color-yellow);">
              <i class="ph-fill ph-warning"></i> High Glucose Alert (1 hr ago)
            </div>
          </div>

        </div>

      </div>
    </div>
  </div>

  <!-- MODALS -->

  <!-- Add Member Modal -->
  <div id="add-member-modal" class="modal-overlay"
    style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:100; align-items:center; justify-content:center;">
    <div
      style="background:var(--card-bg); padding:30px; border-radius:24px; width:400px; border:1px solid var(--glass-border); backdrop-filter:blur(20px);">
      <h2 style="margin-bottom:20px;">Add Family Member</h2>
      <input type="text" id="new-member-name" placeholder="Name"
        style="width:100%; padding:12px; margin-bottom:10px; background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); color:white; border-radius:12px;">
      <select id="new-member-rel"
        style="width:100%; padding:12px; margin-bottom:20px; background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); color:white; border-radius:12px;">
        <option value="Parent">Parent</option>
        <option value="Sibling">Sibling</option>
        <option value="Child">Child</option>
        <option value="Partner">Partner</option>
      </select>
      <div style="display:flex; gap:10px;">
        <button onclick="closeAddMemberModal()"
          style="flex:1; padding:12px; background:transparent; border:1px solid var(--glass-border); color:white; border-radius:12px; cursor:pointer;">Cancel</button>
        <button onclick="saveNewMember()"
          style="flex:1; padding:12px; background:var(--color-blue); border:none; color:white; border-radius:12px; cursor:pointer;">Add</button>
      </div>
    </div>
  </div>

  <!-- Call Modal -->
  <div id="call-modal" class="modal-overlay"
    style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:100; align-items:center; justify-content:center; flex-direction:column;">
    <img id="call-avatar" src=""
      style="width:120px; height:120px; border-radius:50%; margin-bottom:20px; border:4px solid var(--color-blue); animation:pulse-ring 2s infinite;">
    <h2 id="call-name" style="font-size:32px; margin-bottom:10px;">--</h2>
    <div style="color:var(--text-muted); margin-bottom:40px;">Calling...</div>
    <button onclick="endCall()"
      style="width:60px; height:60px; border-radius:50%; background:var(--color-red); border:none; color:white; font-size:24px; cursor:pointer; display:flex; align-items:center; justify-content:center;"><i
        class="ph-fill ph-phone-slash"></i></button>
  </div>

  <style>
    @keyframes pulse-ring {
      0% {
        box-shadow: 0 0 0 0 rgba(10, 132, 255, 0.7);
      }

      70% {
        box-shadow: 0 0 0 20px rgba(10, 132, 255, 0);
      }

      100% {
        box-shadow: 0 0 0 0 rgba(10, 132, 255, 0);
      }
    }
  </style>

  <script type="module">
    import { injectDemoData } from './js/demo-data.js';
    import { translatePage } from './js/localization.js';

    document.addEventListener('DOMContentLoaded', () => {
      injectDemoData();
      translatePage(localStorage.getItem('hf_lang') || 'en');
    });

    window.openAddMemberModal = () => { document.getElementById('add-member-modal').style.display = 'flex'; }
    window.closeAddMemberModal = () => { document.getElementById('add-member-modal').style.display = 'none'; }

    window.saveNewMember = () => {
      const name = document.getElementById('new-member-name').value;
      const rel = document.getElementById('new-member-rel').value;
      if (!name) return;

      const grid = document.querySelector('.section-grid');
      const card = document.createElement('div');
      card.className = 'family-card';
      card.style.cssText = "background:linear-gradient(135deg, rgba(30,41,59,0.5), rgba(0,0,0,0.4)); border:1px solid var(--glass-border); padding:20px; border-radius:20px; animation:fadeIn 0.5s;";
      card.innerHTML = `
            <div class="head" style="display:flex; gap:15px; align-items:center; margin-bottom:20px;">
              <img src="https://ui-avatars.com/api/?name=${name}&background=random" style="width:50px; height:50px; border-radius:50%; border:2px solid var(--color-blue);">
              <div style="flex:1;">
                <h3 style="margin:0; font-size:18px;">${name}</h3>
                <div style="font-size:12px; color:var(--text-muted); display:flex; gap:6px; align-items:center;">
                  <span style="width:6px; height:6px; background:gray; border-radius:50%;"></span>
                  Offline
                </div>
              </div>
              <button class="pill small ghost" onclick="simCall('${name}')">Call</button>
            </div>
            <div style="text-align:center; padding:20px; color:var(--text-muted); font-size:12px; background:rgba(255,255,255,0.02); border-radius:12px;">
                Waiting for device sync...
            </div>
        `;
      grid.appendChild(card);
      closeAddMemberModal();
    }

    window.simCall = (name) => {
      const modal = document.getElementById('call-modal');
      document.getElementById('call-name').innerText = name;
      document.getElementById('call-avatar').src = `https://ui-avatars.com/api/?name=${name}&background=random&size=200`;
      modal.style.display = 'flex';
    }

    window.endCall = () => {
      document.getElementById('call-modal').style.display = 'none';
    }

    // Bind existing buttons
    const btns = document.querySelectorAll('.family-card button');
    if (btns[0]) btns[0].onclick = () => simCall('Dad');
    if (btns[1]) btns[1].onclick = () => alert("Opening Map Tracking...");
  </script>
</body>

</html>